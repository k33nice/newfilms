<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--<link rel="stylesheet" href="../css/style.css"> -->
    <link href="static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <style>
        body{width: 50%;margin: 0 auto;}
        form {display: inline-block; margin: 0.5em;}
        ul{list-style: none;}
        span{margin: 0 0.6em;}
    </style>
</head>
<body>
    <nav>
        <a href="/">Главная</a>
        <a href="/add">Добавить</a>
        <!-- <a href="/delete">Удалить</a> -->
        <a href="/import">Импорт</a>
    </nav>
    <input type="submit" name="add-request" value="добавить">
    <div id="handler"></div>
    <div class="a"></div>
    <p></p>
    <script src="static/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script>

    jQuery(document).ready(function($) {

        // $("#add").submit(function(event) {
        //     event.preventDefault();
        //     $.ajax({
        //         url: '/api/films',
        //         type: 'post',
        //         // data: $("#put").serializeArray(),
        //         success: function(data) {
        //             // $("#results").html(data);
        //         }
        //     });
        // });



        $.ajax({
                url: "/api/films"+url,
                type: "GET",

                contentType: "application/json; charset=utf-8",
                success: function(resultData) {

                        var u = new RegExp("/\d*");
                        if(u.test(url)===false) {
                            delete this.url;
                        };

                    switch(url) {
                        case "/":
                            var films = [];
                            $.each(resultData, function(key, val) {

                                var fil = [];

                                $.each(val, function(k, value) {
                                    fil.push(
                                        "<li id='" + value.Id + "'>"+
                                            "<form method='post' action='api/films/"+ value.Id+"'>"+
                                                "<input value='DELETE' name='_METHOD' type='hidden'>" +
                                                "<input value='удалить' type='submit' class='del-butt' name='del-submit'>"
                                                + value.Name +
                                           "</form>"+
                                           "<a href='"+value.Id +"'>Info</a>"+
                                       "</li>"
                                       );
                                });
                                $("<ul/>", {
                                    "class": "films",
                                    html: fil.join("")
                                }).appendTo("div.a");
                            });
                            break;
                        case url:
                            var films = [];
                            $.each(resultData, function(key, value) {

                                    films.push(
                                        "<li id='" + value.Id + "'>"+
                                            "<form method='post' action='api/films/"+ value.Id+"'>"+
                                                "<input value='DELETE' name='_METHOD' type='hidden'>" +
                                                "<input value='удалить' type='submit' class='del-butt' name='del-submit'>"
                                                + "<span>"+value.Name+"</span><span>"+value.Year+"</span><span>"+value.Format+"</span>"+
                                           "</form>"+
                                       "</li>"
                                       );

                            });
                              $("<ul/>", {
                                    "class": "films",
                                    html: films.join("")
                                }).appendTo("div.a");
                              break;

                   } //End switch
                },
                timeout: 120000,
            });


    });

    $("input[name=add-request]").click(function() {
        var addForm = document.createElement("form");
                    addForm.setAttribute("method", "post");
                    addForm.setAttribute("action", "/");
                    addForm.setAttribute("id", "add");

                var titleAddImput = document.createElement("input");
                    titleAddImput.setAttribute("type", "text");
                    titleAddImput.setAttribute("name", "title");
                    titleAddImput.setAttribute("value", "title");

                var yearAddImput = document.createElement("input");
                    yearAddImput.setAttribute("type", "text");
                    yearAddImput.setAttribute("name", "year");
                    yearAddImput.setAttribute("value", "year");

                var formatAddImput = document.createElement("input");
                    formatAddImput.setAttribute("type", "text");
                    formatAddImput.setAttribute("name", "format");
                    formatAddImput.setAttribute("value", "format");

                // var actorAddImput = document.createElement("input");
                //     actorAddImput.setAttribute("type", "text");
                //     actorAddImput.setAttribute("name", "actor");
                //     actorAddImput.setAttribute("value", "actor");

                var addSubmit = document.createElement("input");
                    addSubmit.setAttribute("type", "submit");
                    addSubmit.setAttribute("value", "добавить");

                addForm.appendChild(titleAddImput);
                addForm.appendChild(yearAddImput);
                addForm.appendChild(formatAddImput);
                // addForm.appendChild(actorAddImput);
                addForm.appendChild(addSubmit);

                document.getElementsByTagName("div")[0].appendChild(addForm);

    });

        /**
         * URL parser
         * @type {[type]}
         */
        var parser = document.createElement('a');
        parser.href = document.URL;

        parser.protocol; // => "http:"
        parser.hostname; // => "example.com"
        parser.port;     // => "3000"
        parser.pathname; // => "/pathname/"
        parser.search;   // => "?search=test"
        parser.hash;     // => "#hash"
        parser.host;     // => "example.com:3000"

        var url = parser.pathname;
        /* End URl parser */

        var id ;

        /**
         *#############################################*
         *#                 Search form               #*
         *#############################################*
         */
            var searchForm = document.createElement("form");
                searchForm.setAttribute("method", "get");
                searchForm.setAttribute("action", "/");

            var searchInput = document.createElement("input");
                searchInput.setAttribute("type", "text");
                searchInput.setAttribute("name", "search");

            var searchSubmit = document.createElement("input");
                searchSubmit.setAttribute("type", "submit");
                searchSubmit.setAttribute("value", "поиск");

                searchForm.appendChild(searchInput);
                searchForm.appendChild(searchSubmit);

                document.getElementsByTagName("div")[0].appendChild(searchForm);
        /**
         *#############################################*
         *#              End Search Form              #*
         *#############################################*
         */


         /**
          * ###########################################*
          *#                  Router                  #*
          *############################################*
          */
        switch (url) {
            case "/add":
                var addForm = document.createElement("form");
                    addForm.setAttribute("method", "post");
                    addForm.setAttribute("action", "api/films/");

                var titleAddImput = document.createElement("input");
                    titleAddImput.setAttribute("type", "text");
                    titleAddImput.setAttribute("name", "title");
                    titleAddImput.setAttribute("value", "title");

                var yearAddImput = document.createElement("input");
                    yearAddImput.setAttribute("type", "text");
                    yearAddImput.setAttribute("name", "year");
                    yearAddImput.setAttribute("value", "year");

                var formatAddImput = document.createElement("input");
                    formatAddImput.setAttribute("type", "text");
                    formatAddImput.setAttribute("name", "format");
                    formatAddImput.setAttribute("value", "format");

                var actorAddImput = document.createElement("input");
                    actorAddImput.setAttribute("type", "text");
                    actorAddImput.setAttribute("name", "actor");
                    actorAddImput.setAttribute("value", "actor");

                var addSubmit = document.createElement("input");
                    addSubmit.setAttribute("type", "submit");
                    addSubmit.setAttribute("value", "добавить");

                addForm.appendChild(titleAddImput);
                addForm.appendChild(yearAddImput);
                addForm.appendChild(formatAddImput);
                addForm.appendChild(actorAddImput);
                addForm.appendChild(addSubmit);

                document.getElementsByTagName("body")[0].appendChild(addForm);

                break;
            case "/import":
                // var deleteForm = document.createElement("form");
                //     deleteForm.setAttribute("method","post");
                //     deleteForm.setAttribute("action","api/films/");

                // var hiddenDeleteInput = document.createElement("input");
                //     hiddenDeleteInput.setAttribute("type","hidden");
                //     hiddenDeleteInput.setAttribute("name","_METHOD");
                //     hiddenDeleteInput.setAttribute("value","DELETE");

                // var submitDeleteInput = document.createElement("input");
                //     submitDeleteInput.setAttribute("type","submit");
                //     submitDeleteInput.setAttribute("value","удалить");

                // deleteForm.appendChild(hiddenDeleteInput);
                // deleteForm.appendChild(submitDeleteInput);

                // document.getElementsByTagName("body")[0].appendChild(deleteForm);

                break;
        };

            // jQuery.ajax({
            //     url: "/api/films"+url,
            //     type: "GET",

            //     contentType: "application/json; charset=utf-8",
            //     success: function(resultData) {

            //             var u = new RegExp("/\d*");
            //             if(u.test(url)===false) {
            //                 delete this.url;
            //             };

            //         switch(url) {
            //             case "/":
            //                 var films = [];
            //                 $.each(resultData, function(key, val) {

            //                     var fil = [];

            //                     $.each(val, function(k, value) {
            //                         fil.push(
            //                             "<li id='" + value.Id + "'>"+
            //                                 "<form method='post' action='api/films/"+ value.Id+"'>"+
            //                                     "<input value='DELETE' name='_METHOD' type='hidden'>" +
            //                                     "<input value='удалить' type='submit' class='del-butt' name='del-submit'>"
            //                                     + value.Name +
            //                                "</form>"+
            //                                "<a href='"+value.Id +"'>Info</a>"+
            //                            "</li>"
            //                            );
            //                     });
            //                     $("<ul/>", {
            //                         "class": "films",
            //                         html: fil.join("")
            //                     }).appendTo("div.a");
            //                 });
            //                 break;
            //             case url:
            //                 var films = [];
            //                 $.each(resultData, function(key, value) {

            //                         films.push(
            //                             "<li id='" + value.Id + "'>"+
            //                                 "<form method='post' action='api/films/"+ value.Id+"'>"+
            //                                     "<input value='DELETE' name='_METHOD' type='hidden'>" +
            //                                     "<input value='удалить' type='submit' class='del-butt' name='del-submit'>"
            //                                     + "<span>"+value.Name+"</span><span>"+value.Year+"</span><span>"+value.Format+"</span>"+
            //                                "</form>"+
            //                            "</li>"
            //                            );

            //                 });
            //                   $("<ul/>", {
            //                         "class": "films",
            //                         html: films.join("")
            //                     }).appendTo("div.a");
            //                   break;

            //        } //End switch
            //     },
            //     timeout: 120000,
            // });
  //   $( "input[name=search]" )
  // .keyup(function() {
  //   var value = $( this ).val();
  //   $( "p" ).text( value );
  // })
  // .keyup();
//   $('input[type=text]').click(function() {
//     this.value = '';
// });
// });
    </script>
</body>
</html>